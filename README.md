# Домашнее задание 1

## Общий смысл

Разбираемся в структуре класс-файла.

## Что делаем 

Мы начинаем разработку своей небольшой JVM.

Она будет учебной, и поэтому маленькой. Совсем игрушечной. И назовем мы 
ее tvm - toy virtual machine.

Прежде, чем что-то исполнять, надо прочитать класс-файл и сохранить его
в своих структурах.

Именно про это и будет задание. Чтобы проверить, чтобы мы все правильно
прочитали, мы добавим специальный режим печати того, что мы прочитали -printClass.

Не надо писать все с нуля. Большая часть служебной логики уже реализована.

Надо дописать несколько важных кусков. Они помечены словом TODO в комментариях.

### 1. Реализовать логику класса ClassReader. 

Поскольку мы сначала пошагово читаем входные данные, пополняя наше знание о классе,
а потом это чтение заканчивается, и мы фиксируем полученное знание, и больше оно не мменяется,
это повод использовать шаблон проектирование Builder.

В существующем коде показан пример использования класса ClassBuilder. Его надо продолжить
и так или иначе вызвать все методы этого класса, перед вызовом build() в конце.

По ходу надо прочитать ConstantPool. Эта логика вынесена в отдельный метод. Там надо воспользоваться
классом CPool::Builder. Там нужно в цикле читать  теги, и в зависимости от тега читать разные комбинации
байтов и вызывать соответсвующие методы этого класса. Там в комментариях сказано, что чему соответствует.

### 2. Реализовать логику декодирования modified UTF8. 

Это в cpoolBuilder.h. 

Алгоритм описан в разделе 4 спецификации JVM.

Вообще, говоря там могут быть любые символы из Unicode16. И этот факт надо учесть в разборе, то есть учесть все варианты.

Но поскольку работать локаль-независимым способом с ASCII-символами, гораздо проще, чем с произвольным Unicode-16,
то в классе CPool::Data заведено два словаря: 

        std::map<u2, std::string> _utf8Entries;
        std::map<u2, std::u16string> _utf8EntriesWide;

Ожидаемое поведение: если при декодировании оказалось, что у нас только ASCII (и без символа с кодом 0), то создаем элемент в ```_utf8Entries```,
иначе - в ```_utf16Entries```.

### 3. Реализовать логику определения имени сущности по индексу в ConstantPool.

Это в сpool.h, fieldBuilder.h и methodBuilder.h

Теоретически, мы можем ожидать того, что здесь будет не ASCII.
Но в тестах все имена классов, полей, методов и аттрибутов используют только ASCII.
И в дальнейшей работе мы будем на это рассчитывать, поэтому можно смело испольвать метод  ascii() и CPool::Entity

Но строковые константы с не-ASCII есть, поэтому все варианты в utf8-декодере должны быть реализованы.

### 4. Реализовать преобразование дескрипторов типа в "человеческое" представление.

classprinter/typeUtil.cc

Мы хотим видеть в выдаче не только текстовые дескрипторы типов, то и типы в удобовоспринимаемом виде.

Для этого надо реализовать пару функций.

## Как проверяем 

По любому действию на GitHub вызывются тесты.
Нужно добиться того, чтобы по вашему коммиту тесты прошли.

Часть тестов лежит в этом же репозитории, часть в отдельном. Почему в отдельном - ну там много бинарных данных, которые не хочется часто менять, и которые не являются неразрывно связанными с этим репозиторием. 

Если хочется прогнать тесты самостоятельно без дейтсвий с гитхабом, можно посмотреть в .github/workflows/cmake.yml, понять, что там делается и сделать то же самое.

## Если есть вопросы и/или претензии к логике тестирования и/или к предоставленному коду

1. Если что-то непонятно в коде tvm - спрашивайте сразу без оговорок. Этот код вспомогательный, и разбираться в нем  не является частью задания.

2. Если что-то непонятно в логике разбора класс-файла, читайте спецификацию. Запустите jdec из asmtools.jar и посмотрите, что он выдает. Это может помочь.
Еслреи совсем запутались и/или уперлись в стену - спрашивайте, с кратким описанием того, куда и как смотрели, чтобы разобраться.

3. Если кажется, что вы все сделали правильно, но тесты падают, и это проблема в тестах - спрашивайте смело. Но постарайтесь перепроверить свою гипотезу.
Я допускаю, что в тестах может быть проблема, но количество ложных сообщений хотелось бы минимизировать.

4. Если кажется, что за пределами TODO-комментариев чего-то не хватает, дайте мне знать. Вместо подумаем, действительно ли это так. 
